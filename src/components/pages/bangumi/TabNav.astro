---
interface Tab {
	id: string;
	name: string;
	count?: number;
}

interface Props {
	tabs: Tab[];
	activeTab: string;
}

const { tabs, activeTab } = Astro.props;
---

<div class="border-b border-(--line-divider) mb-3">
  <nav class="flex space-x-8" aria-label="Tabs">
    {tabs.map((tab) => (
      <button
        class:list={[
          "whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm transition-colors duration-200",
          {
            "border-(--primary) text-(--primary)": tab.id === activeTab,
            "border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300": tab.id !== activeTab
          }
        ]}
        data-tab={tab.id}
        type="button"
      >
        {tab.name}
        {tab.count !== undefined && (
          <span class="ml-2 bg-(--btn-regular-bg) text-(--btn-content) py-0.5 px-2 rounded-full text-xs">
            {tab.count}
          </span>
        )}
      </button>
    ))}
  </nav>
</div>

<script>
  function initTabNavigation() {
    const tabButtons = document.querySelectorAll('[data-tab]');
    const sections = document.querySelectorAll('[data-section]');

    function hydrateVisibleImages(targetTab: string) {
      const visibleItems = document.querySelectorAll(
        `[data-section="${targetTab}"] [data-item-section="${targetTab}"]:not(.hidden)`
      );

      visibleItems.forEach((item) => {
        const htmlItem = item as HTMLElement;
        if (htmlItem.style.display === 'none') {
          return;
        }

        const image = htmlItem.querySelector('img[data-src]');
        if (image) {
          const deferredSrc = image.getAttribute('data-src');
          if (deferredSrc) {
            image.setAttribute('src', deferredSrc);
            image.removeAttribute('data-src');
          }
        }
      });
    }

    tabButtons.forEach(button => {
      button.addEventListener('click', (event) => {
        const currentButton = event.currentTarget as HTMLButtonElement;
        const targetTab = currentButton.dataset.tab;

        // Update active tab
        tabButtons.forEach(btn => {
          btn.classList.remove('border-(--primary)', 'text-(--primary)');
          btn.classList.add('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300');
        });

        currentButton.classList.remove('border-transparent', 'text-gray-500', 'hover:text-gray-700', 'hover:border-gray-300', 'dark:text-gray-400', 'dark:hover:text-gray-300');
        currentButton.classList.add('border-(--primary)', 'text-(--primary)');

        // Show/hide sections
        sections.forEach(section => {
          const htmlSection = section as HTMLElement;
          if (htmlSection.dataset.section === targetTab) {
            htmlSection.classList.remove('hidden');
          } else {
            htmlSection.classList.add('hidden');
          }
        });

        if (targetTab) {
          hydrateVisibleImages(targetTab);
        }
      });
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initTabNavigation);
  } else {
    initTabNavigation();
  }
</script>